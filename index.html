<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creador de p√°ginas</title>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: #0f172a;
      color: white;
      margin: 0;
      padding: 16px;
    }
    .contenedor {
      max-width: 600px;
      margin: auto;
    }
    .pantalla { display: none; }
    .pantalla.activa { display: block; }
    input, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
    }
    textarea {
      height: 220px;
      resize: vertical;
    }
    button {
      background: #38bdf8;
      font-weight: bold;
      cursor: pointer;
    }
    .btn-publicar {
      background: #22c55e;
    }
    .btn-ia {
      background: #f59e0b; /* Color naranja para diferenciarlo */
      color: white;
    }
    .loading { 
      display: none; 
      text-align: center; 
      margin-top: 10px; 
      color: #f59e0b; 
      font-weight: bold; 
    }
  </style>
</head>
<body>

<div class="contenedor">

  <div id="pantalla1" class="pantalla activa">
    <h2>üì± Crea tu p√°gina</h2>
    <input id="nombrePagina" placeholder="Nombre de tu p√°gina">
    <button onclick="entrar()">Entrar</button>
  </div>

  <div id="pantalla2" class="pantalla">
    <h2 id="tituloPagina"></h2>
    <textarea id="htmlInput" placeholder="Peg√° el HTML de tu pagina aca..."></textarea>
    <button onclick="verPagina(false)">üëÅ Ver</button>
    <button class="btn-ia" onclick="irAIa()">‚ú® Generar con IA</button>
    <button class="btn-publicar" onclick="verPagina(true)">üöÄ Publicar</button>
    <button onclick="nuevaPagina()">‚ûï Crear otra p√°gina</button>
  </div>

  <div id="pantallaIa" class="pantalla">
    <h2>‚ú® Expl√≠cale a la IA...</h2>
    <textarea id="iaPrompt" placeholder="Ej: Crea una p√°gina con fondo negro, texto verde ne√≥n que diga HOLA MUNDO y un bot√≥n rojo..."></textarea>
    <div id="loader" class="loading">La IA est√° escribiendo el c√≥digo... ‚è≥</div>
    <button class="btn-ia" id="btnGen" onclick="generarGratis()">Generar ahora</button>
    <button style="background:#475569; color:white;" onclick="irAEditor()">‚¨Ö Volver al Editor</button>
  </div>

</div>

<script>
  let nombre = "";

  // Cargar borrador si existe
  window.onload = () => {
    const draftNombre = localStorage.getItem("draft_nombre");
    const draftHtml = localStorage.getItem("draft_html");

    if (draftNombre && draftHtml) {
      nombre = draftNombre;
      nombrePagina.value = draftNombre;
      htmlInput.value = draftHtml;
      tituloPagina.innerText = "Editando: " + nombre;

      pantalla1.classList.remove("activa");
      pantalla2.classList.add("activa");
    }
  };

  function entrar() {
    nombre = nombrePagina.value.trim();
    if (!nombre) return alert("Pon√© un nombre");
    localStorage.setItem("draft_nombre", nombre);
    tituloPagina.innerText = "Editando: " + nombre;
    pantalla1.classList.remove("activa");
    pantalla2.classList.add("activa");
  }

  // Funciones de navegaci√≥n
  function irAIa() {
    pantalla2.classList.remove("activa");
    pantallaIa.classList.add("activa");
  }

  function irAEditor() {
    pantallaIa.classList.remove("activa");
    pantalla2.classList.add("activa");
  }

  // MOTOR IA (Gratis y sin API Keys)
  async function generarGratis() {
    const promptUser = document.getElementById('iaPrompt').value;
    if (!promptUser) return alert("Dime qu√© quieres que haga la IA");

    const btn = document.getElementById('btnGen');
    const loader = document.getElementById('loader');
    btn.disabled = true;
    loader.style.display = "block";

    try {
      const response = await fetch("https://text.pollinations.ai/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          messages: [
            { role: "system", content: "Eres un experto en HTML y CSS. Responde SOLO con el c√≥digo solicitado. Sin explicaciones, sin markdown." },
            { role: "user", content: `Genera el c√≥digo HTML y CSS para una p√°gina llamada ${nombre}. Requisito: ${promptUser}` }
          ],
          model: "openai"
        })
      });

      const texto = await response.text();
      let codigoLimpio = texto.replace(/```html|```css|```/gi, "").trim();
      
      document.getElementById('htmlInput').value = codigoLimpio;
      localStorage.setItem("draft_html", codigoLimpio);
      
      alert("¬°C√≥digo generado!");
      irAEditor(); // Vuelve al editor para que el usuario pueda ver, editar o publicar

    } catch (error) {
      alert("Error al conectar. Intenta de nuevo.");
    } finally {
      btn.disabled = false;
      loader.style.display = "none";
    }
  }

  function verPagina(publicado) {
    localStorage.setItem("draft_html", htmlInput.value);

    if (publicado) {
      localStorage.setItem("page_" + nombre, htmlInput.value);
      location.hash = nombre;
    }

    abrirVista(htmlInput.value, publicado);
  }

  function nuevaPagina() {
    if (!confirm("¬øCrear una p√°gina nueva? Se perder√° el borrador actual.")) return;
    localStorage.removeItem("draft_nombre");
    localStorage.removeItem("draft_html");
    location.hash = "";
    location.reload();
  }

  function abrirVista(html, publicado) {
    document.open();
    document.write(`<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${nombre}</title>
<style>
body { margin:0; font-family:system-ui; }
#barra {
  position:fixed;
  top:10px;
  left:10px;
  display:flex;
  gap:10px;
  z-index:9999;
  transition: opacity 0.3s ease;
}
.btn {
  background:black;
  color:white;
  padding:10px 14px;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
#toggleBtn {
  position: fixed;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.6);
  color: white;
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
  z-index: 10000;
  user-select: none;
}
</style>
</head>
<body>
<div id="barra">
  ${publicado ? "" : `<div class="btn" onclick="location.reload()">‚¨Ö Editor</div>`}
  <div class="btn" onclick="compartir()">üì§ Compartir</div>
</div>
<div id="toggleBtn" onclick="toggleBar()">üëÅÔ∏è</div>
${html}
<script>
function compartir() {
  const url = location.href;
  if (navigator.share) {
    navigator.share({ title: document.title, url });
  } else {
    navigator.clipboard.writeText(url);
    alert("Link copiado");
  }
}
function toggleBar() {
  const barra = document.getElementById('barra');
  const toggle = document.getElementById('toggleBtn');
  if (barra.style.opacity === '0') {
    barra.style.opacity = '1';
    barra.style.pointerEvents = 'auto';
    toggle.textContent = 'üëÅÔ∏è';
  } else {
    barra.style.opacity = '0';
    barra.style.pointerEvents = 'none';
    toggle.textContent = 'üôà';
  }
}
<\/script>
</body>
</html>`);
    document.close();
  }
</script>

</body>
</html>
